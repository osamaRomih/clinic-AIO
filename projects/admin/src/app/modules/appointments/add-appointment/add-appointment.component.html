<div class="page-wrapper">

  <div class="breadcrumb">
    <li>
      <h4 class="page-title">Book Appointment</h4>
    </li>
    <mat-icon>chevron_right</mat-icon>
    <li class="breadcrumb-item breadcrumb-icon d-flex align-items-center"><img src="/assets/images/home.svg" /></li>
    <mat-icon>chevron_right</mat-icon>
    <li class="breadcrumb-item">Appointment</li>
    <mat-icon>chevron_right</mat-icon>
    <li class="breadcrumb-item active">Book</li>
  </div>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Book Appointment</mat-card-title>
      <mat-card-subtitle>Fill in the details to schedule a patient appointment</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form class="m-4" [formGroup]="appointmentForm" (ngSubmit)="onSubmit()">
        <div class="row">
          <div class="mb-3 col-md-6 col-lg-4 col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Choose a date</mat-label>
              <input matInput formControlName="date" [matDatepicker]="picker" (dateChange)="filterTimeSlotsByDate($event)">
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-error libFieldError></mat-error>
            </mat-form-field>
          </div>
          <div class="mb-3 col-md-6 col-lg-4 col-12">
            <mat-form-field class="w-100">
              <mat-label>Patient</mat-label>
              <mat-select formControlName="patientId">
                <mat-option value="">-- Select patient --</mat-option>
                @for (patient of patients; track patient.id) {
                  <mat-option [value]="patient.id">
                    <div class="d-flex align-items-center">
                      <img [src]="'http://localhost:5069/'+patient.imageUrl" class="patient-img" />
                    <div class="ms-2">
                      <div>{{ patient.fullName }}</div>
                      <div class="fs-6 text-muted">{{patient.phoneNumber}}</div>
                    </div>
                    </div>
                  </mat-option>
                }
              </mat-select>

              <mat-error libFieldError></mat-error>
            </mat-form-field>
          </div>
          <div class="mb-3 col-md-6 col-lg-4 col-12">
            <mat-form-field appearance="outline" class="w-100">

              <mat-label>Times</mat-label>
              <mat-select matNativeControl required formControlName="timeSlotId">
                <mat-option value="">-- Select time --</mat-option>
                @for (time of timeSlots; track time.id) {
                <mat-option [value]="time.id" [disabled]="time.isBooked">{{ time.startTime.substring(0,5) }} - {{ time.endTime.substring(0,5)}}</mat-option>
                }
              </mat-select>
              <mat-error libFieldError></mat-error>

            </mat-form-field>
          </div>
          <div class="mb-3 col-md-6 col-lg-4 col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Reason for Visit</mat-label>
              <textarea matInput formControlName="reasonForVisit" placeholder="Describe reason for the visit" rows="3">
              </textarea>
              <mat-error libFieldError></mat-error>

            </mat-form-field>
          </div>
          <div class="mb-3 col-md-6 col-lg-4 col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Visit Type</mat-label>
              <mat-select formControlName="visitType">
                <mat-option value="New">New Patient</mat-option>
                <mat-option value="FollowUp">Follow Up</mat-option>
                <mat-option value="Consultation">Consultation</mat-option>
              </mat-select>

              <mat-error libFieldError></mat-error>
            </mat-form-field>
          </div>



        </div>
        <div class="row">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3 text-end">
            <button type="submit" mat-flat-button color="primary" [disabled]="appointmentForm.invalid">Submit
              Appointment</button>
          </div>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>