<ng-container>
  <div class="materialTableHeader">
    <div class="left">
      <ul class="d-flex mb-0 list-unstyled ">
        <li class="ms-3 d-flex align-items-center">
          <h2>{{title}}</h2>
        </li>
        <li class="tbl-search-box ms-2 position-relative">
          <label for="search-input">
            <mat-icon class="search-icon">search</mat-icon>
          </label>
          <input matInput type="search" (keyup)="applyFilter($event)" placeholder="Search" #input class="search-field"
            id="search-input">
        </li>
      </ul>
    </div>
    <div class="right">
      <button mat-icon-button matTooltip="Add" matTooltipPosition="below" class="btn-delete me-2" (click)="onAdd()">
        <mat-icon color="warn">add</mat-icon>
      </button>
      <button *ngIf="enableSelection && selection.hasValue()" mat-icon-button matTooltip="Delete selected"
        matTooltipPosition="below" class="btn-delete me-2" (click)="confirmBulkDelete()">
        <mat-icon color="warn">delete</mat-icon>
      </button>
      @if(isExportable){
        <button mat-icon-button matTooltip="Xlsx Dlownload" matTooltipPosition="below" class="btn-download"
          (click)="exportAsExcel()">
          <mat-icon class="file-download-icon">file_download</mat-icon>
        </button>
      }
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-auto">
    <div class="table-container">
      <table mat-table [dataSource]="tableDataSource" matSort (matSortChange)="sortTable($event)">
        <!-- checkbox column -->
        <ng-container *ngIf="enableSelection" matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox (change)="toggleAll()" [checked]="isAllSelected()"
              [indeterminate]="selection.selected.length > 0 && !isAllSelected()" [aria-label]="checkboxLabel()">
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
              [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)">
            </mat-checkbox>
          </td>
        </ng-container>
        <ng-container *ngFor="let tableColumn of tableColumns" [matColumnDef]="tableColumn.dataKey">


          <ng-container *ngIf="tableColumn.isSortable; else notSortable">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ tableColumn.name }} </th>
          </ng-container>
          <ng-template #notSortable>
            <th mat-header-cell *matHeaderCellDef> {{ tableColumn.name }} </th>
          </ng-template>

          <td mat-cell *matCellDef="let element">
            @if(tableColumn.dataKey === 'patientName'){
            <ng-container>
              <div style="display:flex; align-items:center; gap:8px;">
                <img [src]="'http://localhost:5069'+element.imageUrl || 'assets/images/avatar.png'"
                  style="width:32px; height:32px; border-radius:50%; object-fit:cover;">
                <span>{{ element.patientName }}</span>
              </div>
            </ng-container>
            }@else if (tableColumn.dataKey=='status') {
            <ng-container>
              <span [ngClass]="getStatusClass(element.status)">{{ element.status }}</span>
            </ng-container>
            }@else if (tableColumn.dataKey=='startTime') {
            <ng-container>
              <span>{{ element.startTime | timeShort }}</span>
            </ng-container>
            }@else if (tableColumn.dataKey=='endTime') {
            <ng-container>
              <span>{{ element.endTime | timeShort }}</span>
            </ng-container>
            }@else if(tableColumn.dataKey=='isBooked'){
            <ng-container>
              <div [ngClass]="element.isBooked ? 'badge rounded-pill bg-danger text-white p-2' : 'badge rounded-pill bg-success text-white p-2'">
              {{ element.isBooked ? 'Booked' : 'Active' }}
              </div>
            </ng-container>
            }@else if(tableColumn.dataKey=='isDeleted'){
            <ng-container>
              <div [ngClass]="element.isDeleted ? 'badge rounded-pill bg-danger text-white p-2' : 'badge rounded-pill bg-success text-white p-2'">
              {{ element.isDeleted ? 'Deleted' : 'Active' }}
              </div>
            </ng-container>
            }@else {
            <ng-container>
              {{ element[tableColumn.dataKey] }}
            </ng-container>
            }

          </td>
        </ng-container>

        <!-- edit/delete actions column -->
        <ng-container *ngIf="showEditDelete" matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>
            <div class="d-flex justify-content-center">Actions</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <div class="d-flex align-items-center justify-content-center gap-3">

              <button mat-icon-button color="primary" (click)="$event.stopPropagation(); onEdit(element.id)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="$event.stopPropagation(); onDelete(element.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="getDisplayedColumns()"></tr>
        <tr mat-row *matRowDef="let row; columns: getDisplayedColumns();" (click)="openDialog(row.id)"></tr>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  <mat-paginator *ngIf="isPageable" [pageSizeOptions]="paginationSizes" [pageSize]="defaultPageSize"
    [length]="totalItems" (page)="onPage($event)" showFirstLastButtons>
  </mat-paginator>
</ng-container>